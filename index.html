<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cartel TV Lite</title>
  <meta name="description" content="Versi√≥n ligera de Cartel TV - Descubre pel√≠culas y series gratis">
  <style>
    :root {
      --primary: #d4af37;
      --bg: #0a0a10;
      --card-bg: #1e1e2f;
      --text: #f8f9fa;
      --text-secondary: #adb5bd;
      --radius: 12px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      overflow-x: hidden;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 1rem;
    }

    .header {
      text-align: center;
      margin-bottom: 2rem;
      padding: 1rem 0;
      border-bottom: 1px solid #2d2d3a;
    }

    .logo {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
    }

    .title {
      font-size: 1.8rem;
      margin-bottom: 0.5rem;
      color: var(--primary);
    }

    .subtitle {
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    .filters {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
      justify-content: center;
    }

    .filter-btn {
      padding: 0.5rem 1rem;
      background: var(--card-bg);
      border: 1px solid #2d2d3a;
      border-radius: var(--radius);
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.2s;
      font-size: 0.9rem;
    }

    .filter-btn.active {
      background: var(--primary);
      color: #000;
      border-color: var(--primary);
    }

    .filter-btn:hover {
      background: #2d2d3a;
    }

    .main-btn {
      width: 100%;
      padding: 1rem;
      background: var(--primary);
      border: none;
      border-radius: var(--radius);
      color: #000;
      font-weight: bold;
      font-size: 1.1rem;
      cursor: pointer;
      margin-bottom: 1.5rem;
      transition: transform 0.2s;
    }

    .main-btn:hover {
      transform: translateY(-2px);
    }

    .main-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .loading {
      text-align: center;
      padding: 2rem;
      display: none;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid #2d2d3a;
      border-top: 3px solid var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 1rem;
    }

    .content-card {
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      text-align: center;
    }

    .poster {
      width: 100%;
      max-width: 300px;
      border-radius: var(--radius);
      margin-bottom: 1rem;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .poster.loaded {
      opacity: 1;
    }

    .movie-title {
      font-size: 1.3rem;
      margin-bottom: 0.5rem;
      color: var(--primary);
    }

    .movie-overview {
      color: var(--text-secondary);
      margin-bottom: 1rem;
    }

    .actions {
      display: flex;
      gap: 0.5rem;
      justify-content: center;
    }

    .action-btn {
      padding: 0.5rem 1rem;
      background: transparent;
      border: 1px solid #2d2d3a;
      border-radius: var(--radius);
      color: var(--text);
      cursor: pointer;
      transition: all 0.2s;
    }

    .action-btn:hover {
      background: #2d2d3a;
    }

    .welcome {
      text-align: center;
      padding: 2rem;
    }

    .welcome-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
    }

    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--card-bg);
      border: 1px solid #2d2d3a;
      border-radius: var(--radius);
      padding: 1rem;
      max-width: 300px;
      transform: translateX(400px);
      transition: transform 0.3s;
      z-index: 1000;
    }

    .notification.show {
      transform: translateX(0);
    }

    /* Modal Premium */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s;
    }

    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .modal {
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 2rem;
      max-width: 500px;
      width: 90%;
      text-align: center;
      transform: scale(0.9);
      transition: transform 0.3s;
    }

    .modal-overlay.active .modal {
      transform: scale(1);
    }

    .modal-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
    }

    .modal-title {
      font-size: 1.5rem;
      margin-bottom: 1rem;
      color: var(--primary);
    }

    .modal-text {
      margin-bottom: 1.5rem;
      color: var(--text-secondary);
    }

    .modal-features {
      text-align: left;
      margin: 1.5rem 0;
      padding-left: 1.5rem;
    }

    .modal-features li {
      margin-bottom: 0.5rem;
    }

    .modal-actions {
      display: flex;
      gap: 1rem;
      justify-content: center;
      margin-top: 1.5rem;
    }

    .modal-btn {
      padding: 0.75rem 1.5rem;
      border-radius: var(--radius);
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
      display: inline-block;
    }

    .modal-btn.primary {
      background: var(--primary);
      color: #000;
      border: none;
    }

    .modal-btn.secondary {
      background: transparent;
      color: var(--text);
      border: 1px solid #2d2d3a;
    }

    .modal-btn:hover {
      transform: translateY(-2px);
    }

    .close-modal {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: none;
      border: none;
      color: var(--text);
      font-size: 1.5rem;
      cursor: pointer;
    }

    .download-app {
      display: flex;
      justify-content: center;
      margin: 1.5rem 0;
    }

    .download-btn {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1.5rem;
      background: var(--primary);
      color: #000;
      border-radius: var(--radius);
      text-decoration: none;
      font-weight: bold;
      transition: transform 0.2s;
    }

    .download-btn:hover {
      transform: translateY(-2px);
    }

    .premium-badge {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: var(--primary);
      color: #000;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-size: 0.7rem;
      font-weight: bold;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @media (max-width: 600px) {
      .container {
        padding: 0.5rem;
      }
      
      .filters {
        gap: 0.25rem;
      }
      
      .filter-btn {
        padding: 0.4rem 0.8rem;
        font-size: 0.8rem;
      }

      .modal-actions {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="header">
      <div class="logo">üé¨</div>
      <h1 class="title">Cartel TV Lite</h1>
      <p class="subtitle">Versi√≥n gratuita - Funciones limitadas</p>
    </header>

    <div class="filters">
      <button class="filter-btn active" data-type="now_playing">En Cines</button>
      <button class="filter-btn" data-type="popular">Populares</button>
      <button class="filter-btn" data-type="upcoming">Pr√≥ximos</button>
    </div>

    <button id="load-btn" class="main-btn">
      üé¨ ¬øQu√© Ver Hoy?
    </button>

    <div id="loading" class="loading">
      <div class="spinner"></div>
      <p>Buscando contenido...</p>
    </div>

    <div id="content" class="content-card">
      <div class="welcome">
        <div class="welcome-icon">üé≠</div>
        <h3>Bienvenido a Cartel TV Lite</h3>
        <p>Haz clic en "¬øQu√© Ver Hoy?" para descubrir contenido</p>
        <p class="subtitle">Versi√≥n gratuita con funciones limitadas</p>
      </div>
    </div>

    <div class="download-app">
      <a href="#" class="download-btn" id="download-app-btn">
        üì± Descargar App
      </a>
    </div>

    <div class="actions">
      <button id="favorite-btn" class="action-btn">‚ù§Ô∏è Favorito</button>
      <button id="share-btn" class="action-btn">üì§ Compartir</button>
      <button id="premium-btn" class="action-btn">‚≠ê Premium</button>
    </div>
  </div>

  <div id="notification" class="notification">
    <span id="notification-text"></span>
  </div>

  <!-- Modal Premium -->
  <div class="modal-overlay" id="premium-modal">
    <div class="modal">
      <button class="close-modal" id="close-modal">√ó</button>
      <div class="premium-badge">PREMIUM</div>
      <div class="modal-icon">‚≠ê</div>
      <h2 class="modal-title">Desbloquea Cartel TV Premium</h2>
      <p class="modal-text">La versi√≥n gratuita tiene funciones limitadas. Actualiza a Premium para disfrutar de todas las caracter√≠sticas:</p>
      <ul class="modal-features">
        <li>Sin l√≠mites de uso</li>
        <li>Acceso a m√°s de 10,000 pel√≠culas y series</li>
        <li>Sin anuncios</li>
        <li>Recomendaciones personalizadas</li>
        <li>Descarga para ver sin conexi√≥n</li>
        <li>Contenido exclusivo</li>
      </ul>
      <div class="modal-actions">
        <a href="https://carteltvsoporte.github.io/cartel-tv-premium/" class="modal-btn primary" target="_blank">Ver Planes Premium</a>
        <button class="modal-btn secondary" id="close-modal-btn">Quiz√°s m√°s tarde</button>
      </div>
    </div>
  </div>

  <script>
    // Configuraci√≥n
    const CONFIG = {
      API_KEY: '487ec2ee423ac20f42f80d2ee5aebab8',
      BASE_URL: 'https://api.themoviedb.org/3',
      IMG_BASE_URL: 'https://image.tmdb.org/t/p/w500'
    };

    // Estado de la aplicaci√≥n
    const State = {
      currentType: 'now_playing',
      currentItem: null,
      favorites: JSON.parse(localStorage.getItem('cartel_lite_favorites')) || [],
      isLoading: false,
      cache: new Map(), // Cache para evitar peticiones repetidas
      lastLoadTime: 0, // Tiempo de la √∫ltima carga
      loadCooldown: 30000 // 30 segundos de espera entre cargas
    };

    // Elementos DOM
    const elements = {
      loadBtn: document.getElementById('load-btn'),
      loading: document.getElementById('loading'),
      content: document.getElementById('content'),
      favoriteBtn: document.getElementById('favorite-btn'),
      shareBtn: document.getElementById('share-btn'),
      premiumBtn: document.getElementById('premium-btn'),
      notification: document.getElementById('notification'),
      notificationText: document.getElementById('notification-text'),
      filterBtns: document.querySelectorAll('.filter-btn'),
      premiumModal: document.getElementById('premium-modal'),
      closeModal: document.getElementById('close-modal'),
      closeModalBtn: document.getElementById('close-modal-btn'),
      downloadAppBtn: document.getElementById('download-app-btn')
    };

    // Mostrar notificaci√≥n
    function showNotification(message, duration = 3000) {
      elements.notificationText.textContent = message;
      elements.notification.classList.add('show');
      
      setTimeout(() => {
        elements.notification.classList.remove('show');
      }, duration);
    }

    // Cargar contenido
    async function loadContent() {
      if (State.isLoading) return;
      
      // Verificar si ha pasado suficiente tiempo desde la √∫ltima carga
      const now = Date.now();
      const timeSinceLastLoad = now - State.lastLoadTime;
      
      if (timeSinceLastLoad < State.loadCooldown) {
        const remainingTime = Math.ceil((State.loadCooldown - timeSinceLastLoad) / 1000);
        showNotification(`‚è≥ Espera ${remainingTime} segundos para ver otra recomendaci√≥n`);
        return;
      }
      
      State.isLoading = true;
      elements.loadBtn.disabled = true;
      elements.loading.style.display = 'block';
      elements.content.innerHTML = '';

      try {
        const items = await fetchContent(State.currentType);
        if (items.length === 0) throw new Error('No hay contenido disponible');
        
        const randomItem = items[Math.floor(Math.random() * items.length)];
        await renderContent(randomItem);
        State.currentItem = randomItem;
        State.lastLoadTime = Date.now();
        
        showNotification('üé¨ ¬°Nueva recomendaci√≥n!');
        
        // Mostrar modal promocional ocasionalmente (30% de probabilidad)
        if (Math.random() < 0.3) {
          setTimeout(() => {
            showPremiumModal();
          }, 2000);
        }
      } catch (error) {
        console.error('Error:', error);
        elements.content.innerHTML = `
          <div class="welcome">
            <div class="welcome-icon">‚ö†Ô∏è</div>
            <h3>Error al cargar contenido</h3>
            <p>${error.message}</p>
          </div>
        `;
      } finally {
        elements.loadBtn.disabled = false;
        elements.loading.style.display = 'none';
        State.isLoading = false;
      }
    }

    // Obtener contenido de la API
    async function fetchContent(type) {
      // Verificar si ya tenemos estos datos en cach√©
      const cacheKey = `${type}_${new Date().toDateString()}`;
      if (State.cache.has(cacheKey)) {
        return State.cache.get(cacheKey);
      }
      
      let url = '';
      
      switch (type) {
        case 'now_playing':
          url = `${CONFIG.BASE_URL}/movie/now_playing?api_key=${CONFIG.API_KEY}&language=es-ES`;
          break;
        case 'popular':
          url = `${CONFIG.BASE_URL}/movie/popular?api_key=${CONFIG.API_KEY}&language=es-ES`;
          break;
        case 'upcoming':
          url = `${CONFIG.BASE_URL}/movie/upcoming?api_key=${CONFIG.API_KEY}&language=es-ES`;
          break;
        default:
          throw new Error('Tipo no soportado');
      }
      
      const response = await fetch(url);
      if (!response.ok) throw new Error('Error en la API');
      
      const data = await response.json();
      const results = data.results || [];
      
      // Guardar en cach√© por un d√≠a
      State.cache.set(cacheKey, results);
      return results;
    }

    // Carga diferida de im√°genes
    function lazyLoadImage(img) {
      return new Promise((resolve, reject) => {
        if (img.complete) {
          resolve();
        } else {
          img.onload = () => resolve();
          img.onerror = () => reject(new Error('Error al cargar la imagen'));
        }
      });
    }

    // Renderizar contenido
    async function renderContent(item) {
      const title = item.title || item.name;
      const year = (item.release_date || item.first_air_date)?.substring(0, 4) || 'N/A';
      const overview = item.overview || 'Sin descripci√≥n disponible.';
      const poster = item.poster_path ? 
        `${CONFIG.IMG_BASE_URL}${item.poster_path}` : 
        'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjQ1MCIgdmlld0JveD0iMCAwIDMwMCA0NTAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIzMDAiIGhlaWdodD0iNDUwIiBmaWxsPSIjMWExYTI1Ii8+Cjx0ZXh0IHg9IjE1MCIgeT0iMjI1IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjNkM3NTdEIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCI+U2luIGltYWdlbjwvdGV4dD4KPC9zdmc+';
      
      elements.content.innerHTML = `
        <img src="${poster}" alt="${title}" class="poster" loading="lazy">
        <h2 class="movie-title">${title} (${year})</h2>
        <p class="movie-overview">${overview}</p>
        <p class="subtitle">‚≠ê Desbloquea m√°s funciones con Cartel TV Premium</p>
      `;
      
      // Carga diferida de la imagen
      const img = elements.content.querySelector('.poster');
      try {
        await lazyLoadImage(img);
        img.classList.add('loaded');
      } catch (error) {
        console.error('Error al cargar la imagen:', error);
        img.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjQ1MCIgdmlld0JveD0iMCAwIDMwMCA0NTAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIzMDAiIGhlaWdodD0iNDUwIiBmaWxsPSIjMWExYTI1Ii8+Cjx0ZXh0IHg9IjE1MCIgeT0iMjI1IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjNkM3NTdEIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCI+RXJyb3IgY2FyZ2FuZG8gaW1hZ2VuPC90ZXh0Pgo8L3N2Zz4=';
        img.classList.add('loaded');
      }
      
      updateFavoriteButton();
    }

    // Manejar favoritos
    function toggleFavorite() {
      if (!State.currentItem) return;
      
      const existingIndex = State.favorites.findIndex(fav => fav.id === State.currentItem.id);
      
      if (existingIndex >= 0) {
        State.favorites.splice(existingIndex, 1);
        showNotification('‚ùå Eliminado de favoritos');
      } else {
        State.favorites.push({
          ...State.currentItem,
          added_at: new Date().toISOString()
        });
        showNotification('‚ù§Ô∏è A√±adido a favoritos');
      }
      
      localStorage.setItem('cartel_lite_favorites', JSON.stringify(State.favorites));
      updateFavoriteButton();
    }

    // Actualizar bot√≥n de favoritos
    function updateFavoriteButton() {
      if (!State.currentItem) {
        elements.favoriteBtn.style.display = 'none';
        return;
      }
      
      elements.favoriteBtn.style.display = 'block';
      const isFavorite = State.favorites.some(fav => fav.id === State.currentItem.id);
      
      elements.favoriteBtn.innerHTML = isFavorite ? 
        'üíî Quitar Favorito' : '‚ù§Ô∏è Favorito';
    }

    // Compartir contenido
    async function shareContent() {
      if (!State.currentItem) return;
      
      const item = State.currentItem;
      const title = item.title || item.name;
      const year = (item.release_date || item.first_air_date)?.substring(0, 4) || '';
      const text = `üé¨ ¬°Mira "${title}${year ? ` (${year})` : ''}" en Cartel TV!`;
      
      if (navigator.share) {
        try {
          await navigator.share({
            title: 'Cartel TV',
            text,
            url: window.location.href
          });
        } catch (error) {
          if (error.name !== 'AbortError') {
            fallbackShare(text);
          }
        }
      } else {
        fallbackShare(text);
      }
    }

    function fallbackShare(text) {
      const shareUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}`;
      window.open(shareUrl, '_blank', 'width=600,height=400');
      showNotification('üì§ Compartiendo en Twitter...');
    }

    // Cambiar filtro
    function changeFilter(type) {
      State.currentType = type;
      
      // Actualizar botones activos
      elements.filterBtns.forEach(btn => {
        btn.classList.toggle('active', btn.dataset.type === type);
      });
      
      showNotification(`Filtro: ${getFilterName(type)}`);
    }

    function getFilterName(type) {
      const names = {
        'now_playing': 'En Cines',
        'popular': 'Populares',
        'upcoming': 'Pr√≥ximos'
      };
      return names[type] || type;
    }

    // Mostrar modal premium
    function showPremiumModal() {
      elements.premiumModal.classList.add('active');
    }

    // Ocultar modal premium
    function hidePremiumModal() {
      elements.premiumModal.classList.remove('active');
    }

    // Inicializar aplicaci√≥n
    function initApp() {
      // Event listeners
      elements.loadBtn.addEventListener('click', loadContent);
      elements.favoriteBtn.addEventListener('click', toggleFavorite);
      elements.shareBtn.addEventListener('click', shareContent);
      elements.premiumBtn.addEventListener('click', showPremiumModal);
      elements.closeModal.addEventListener('click', hidePremiumModal);
      elements.closeModalBtn.addEventListener('click', hidePremiumModal);
      
      elements.filterBtns.forEach(btn => {
        btn.addEventListener('click', () => changeFilter(btn.dataset.type));
      });
      
      // Enlace de descarga de la app
      elements.downloadAppBtn.addEventListener('click', function(e) {
        e.preventDefault();
        showNotification('üì± Redirigiendo a la tienda de aplicaciones...');
        // Enlace gen√©rico para la app
        setTimeout(() => {
          window.open('https://play.google.com/store/apps', '_blank');
        }, 1000);
      });
      
      // Ocultar botones inicialmente
      updateFavoriteButton();
      elements.shareBtn.style.display = State.currentItem ? 'block' : 'none';
      
      // Mostrar modal de bienvenida despu√©s de un tiempo
      setTimeout(() => {
        showPremiumModal();
      }, 3000);
      
      console.log('üé¨ Cartel TV Lite iniciado');
    }

    // Iniciar cuando el DOM est√© listo
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initApp);
    } else {
      initApp();
    }
  </script>
</body>
</html>