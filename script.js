const State={currentType:'old_movies',viewCount:parseInt(localStorage.getItem('ctvl_view_count')||'0'),lastViewTime:parseInt(localStorage.getItem('ctvl_last_view_time')||'0')};function initApp(){setupPremiumButtons();updateCounter();const loadBtn=document.getElementById('load-btn');if(loadBtn){loadBtn.addEventListener('click',loadContent);}const filterBtns=document.querySelectorAll('.filter-btn');filterBtns.forEach(btn=>{btn.addEventListener('click',()=>{filterBtns.forEach(b=>b.classList.remove('active'));btn.classList.add('active');State.currentType=btn.dataset.type;});});setInterval(updateCounter,60000);if(State.viewCount>=5){showPremiumBanner();}}function setupPremiumButtons(){document.querySelectorAll('.btn-premium,.btn-premium-small,.btn-premium-block').forEach(btn=>{btn.addEventListener('click',()=>{window.location.href='https://carteltvsoporte.github.io/ctvp/?forced=true';});});}function updateCounter(){const usageCount=document.getElementById('usage-count');if(usageCount)usageCount.textContent=`${State.viewCount}/30`;}function incrementCount(){State.viewCount++;State.lastViewTime=Date.now();localStorage.setItem('ctvl_view_count',State.viewCount.toString());localStorage.setItem('ctvl_last_view_time',State.lastViewTime.toString());updateCounter();if(State.viewCount>=3)showPremiumBanner();}function showPremiumBanner(){const banner=document.querySelector('.premium-banner');if(banner)banner.style.display='block';}function showPremiumBlock(){const contentArea=document.getElementById('content-area');if(contentArea){contentArea.innerHTML=`<div class="premium-block"><h3>LÍMITE ALCANZADO</h3><p>Has usado ${State.viewCount} de 30 contenidos hoy</p><div class="premium-demand"><p><strong>¡NO PUEDES VER MÁS!</strong></p><ul><li>❌ Versión Lite bloqueada</li><li>❌ Solo contenido antiguo</li><li>❌ Calidad reducida</li><li>❌ Límites estrictos</li></ul><p><strong>SOLUCIÓN ÚNICA:</strong></p><button class="btn-premium-block">OBTENER PREMIUM AHORA</button></div></div>`;setupPremiumButtons();}}async function loadContent(){const canView=await canViewContent();if(!canView){showPremiumBlock();return;}const btn=document.getElementById('load-btn');const contentArea=document.getElementById('content-area');if(btn)btn.disabled=true;try{const items=await fetchContentByType(State.currentType);if(items.length>0){const randomIndex=Math.floor(Math.random()*items.length);showContent(items[randomIndex]);incrementCount();}else{contentArea.innerHTML='<p class="limit-message">No hay contenido disponible en versión Lite</p>';}}catch(error){contentArea.innerHTML='<p class="limit-message">Error de conexión. Versión Lite limitada.</p>';}finally{if(btn)btn.disabled=false;}}function showContent(item){const contentArea=document.getElementById('content-area');const title=item.title||item.name;const year=item.release_date?.substring(0,4)||item.first_air_date?.substring(0,4)||'Antiguo';contentArea.innerHTML=`<div class="premium-block"><h3>CONTENIDO ANTIGUO (LITE)</h3><p><strong>${title} (${year})</strong></p><p style="color:#777;margin:15px 0;">Este contenido es anterior a 2010. Calidad reducida en versión Lite.</p><div class="premium-demand"><p><strong>¿QUIERES VER CONTENIDO ACTUAL?</strong></p><ul><li>❌ Esta película/serie tiene más de 10 años</li><li>❌ Imágenes en baja resolución</li><li>❌ Información limitada</li><li>❌ Solo muestra contenido viejo</li></ul><button class="btn-premium-block">VER CONTENIDO ACTUAL CON PREMIUM</button></div></div>`;setupPremiumButtons();}window.addEventListener('DOMContentLoaded',initApp);